---
# file: roles/gateway/tasks/interfaces.yml

- name: Disable Hetzner cloud config
  copy:
    content: "network: {config: disabled}"
    dest: /etc/cloud/cloud.cfg.d/99-disable-network-config.cfg
    force: yes
  when: provider is defined and provider == "hetzner"

- name: Delete Hetzner cloud config as well
  file:
    name: /etc/network/interfaces.d/50-cloud-init
    state: absent
  when: provider is defined and provider == "hetzner"

- name: Template /etc/network/interfaces
  template:
    src: 'interfaces.j2'
    dest: '/etc/network/interfaces'
    owner: root
    group: root
    mode: 0644
  notify: reload networking
